import{a as L,b as v}from"./chunk-HTE3K6N3.js";import{E as T,H as _,I as C,J as I,L as M,N as F,a as g,d as y,g as D,j as n,k as p,l as E,n as l,p as d,q as s,r as c,t as h,x as b,y as S}from"./chunk-F4SGC7SP.js";var m=class r{static parseDate(a){let o=a.split("/"),e=parseInt(o[0],10),t=parseInt(o[1],10)-1,i=parseInt(o[2],10);return new Date(i,t,e)}static format(a){let o=r.parseDate(a),e=o.toLocaleString("default",{year:"numeric"}),t=o.toLocaleString("default",{month:"2-digit"}),i=o.toLocaleString("default",{day:"2-digit"});return`${e}-${t}-${i}`}static formatFromDateTime(a){let o=new Date(a),e=o.toLocaleString("default",{year:"numeric"}),t=o.toLocaleString("default",{month:"2-digit"});return`${o.toLocaleString("default",{day:"2-digit"})}/${t}/${e}`}static isDateGreaterOrEqualThanToday(a){let o=r.parseDate(a),e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return o>=t}static isDateExactlyAYearLaterThanOtherDate(a,o){let e=r.parseDate(a),t=r.parseDate(o),i=e.getFullYear(),u=t.getFullYear(),R=e.getMonth(),P=t.getMonth(),V=e.getDate(),k=t.getDate();return u===i+1&&(P===R&&k===V)}};var W=(()=>{let a=class a{constructor(e,t,i){this.router=e,this.productService=t,this.notificationService=i,this.model=E({}),this.formValid=!0,this.validations=void 0,this.errorMessage=void 0,this.mode=f.CREATE,S(()=>{this.validateId(),this.updateFormValidFlag()})}ngOnInit(){this.validations=new Map([["id",[{name:"required"},{name:"min",value:"3"},{name:"max",value:"10"}]],["name",[{name:"required"},{name:"min",value:"5"},{name:"max",value:"100"}]],["description",[{name:"required"},{name:"min",value:"10"},{name:"max",value:"200"}]],["logo",[{name:"required"}]],["date_release",[{name:"required"},{name:"custom",fn:this.validateDateRelease,model:this.model,message:"La fecha debe ser mayor o igual a la actual!"}]],["date_revision",[{name:"required"},{name:"custom",fn:this.validateDateRevision,model:this.model,message:"La fecha debe ser exactamente un a\xF1o posterior a la fecha de liberacion!"}]]]),this.cleanValidations(),this.productService.getProduct()&&(this.model.set(this.mapToProduct(this.productService.getProduct()||{})),this.mode=f.EDIT)}isEditMode(){return this.mode===f.EDIT}mapToProduct(e){let t={};return t.id=e.id,t.name=e.name,t.description=e.description,t.logo=e.logo,t.date_release=m.formatFromDateTime(e.date_release),t.date_revision=m.formatFromDateTime(e.date_revision),t}create(){let e=this.model();if(e){let t=g({},e);t.date_release=m.format(e.date_release),t.date_revision=m.format(e.date_revision),this.isEditMode()?this.productService.update(v,t).subscribe({next:()=>{this.notificationService.addSuccess("Producto actualizado exitosamente!"),this.router.navigateByUrl("/product-list")},error:i=>{this.notificationService.addError("Error al intentar actualizar el producto!")}}):this.productService.create(v,t).subscribe({next:()=>{this.notificationService.addSuccess("Producto creado exitosamente!"),this.router.navigateByUrl("/product-list")},error:i=>{this.notificationService.addError("Error al intentar actualizar el producto!")}})}}clearModel(){let e=this.model()?.id||"";this.isEditMode()?this.model.set({id:e}):this.model.set({})}validateId(){if(!this.isEditMode()){this.errorMessage=void 0;let e=this.model();e&&e.id&&this.productService.verify(v,e).pipe(y(t=>{t&&(this.errorMessage="ID no v\xE1lido!")})).subscribe()}}validateDateRelease(){return m.isDateGreaterOrEqualThanToday(this.model()?.date_release||"")}validateDateRevision(){return m.isDateExactlyAYearLaterThanOtherDate(this.model()?.date_release||"",this.model()?.date_revision||"")}cleanValidations(){if(this.validations)for(let e of this.validations)e[1].forEach(t=>{t.valid=!0})}updateFormValidFlag(){let e=!0;if(this.validations){for(let t of this.validations)if(t[1].find(u=>!u.valid)){e=!1;break}}this.formValid=e}};a.\u0275fac=function(t){return new(t||a)(p(T),p(L),p(M))},a.\u0275cmp=D({type:a,selectors:[["product-edit"]],standalone:!0,features:[b],decls:20,vars:17,consts:[["title","Formulario de Registro"],[1,"row"],[1,"col"],["attr","id","label","ID",3,"model","validations","errorMessage","enabled"],["attr","name","label","Nombre","placeholder","Tarjeta Cr\xE9dito",3,"model","validations"],["attr","description","label","Descripci\xF3n",3,"model","validations"],["attr","logo","label","Logo",3,"model","validations"],["attr","date_release","label","Fecha Liberaci\xF3n","placeholder","22/02/2023",3,"model","validations"],["attr","date_revision","label","Fecha Revisi\xF3n","placeholder","22/02/2024",3,"model","enabled","validations"],[1,"col","buttons-layout"],["label","Reiniciar",3,"click","primary"],["label","Enviar",3,"click","enabled"]],template:function(t,i){t&1&&(d(0,"panel",0)(1,"div",1)(2,"div",2),c(3,"text-field",3),s(),d(4,"div",2),c(5,"text-field",4),s()(),d(6,"div",1)(7,"div",2),c(8,"text-field",5),s(),d(9,"div",2),c(10,"text-field",6),s()(),d(11,"div",1)(12,"div",2),c(13,"text-field",7),s(),d(14,"div",2),c(15,"text-field",8),s()(),d(16,"div",1)(17,"div",9)(18,"custom-button",10),h("click",function(){return i.clearModel()}),s(),d(19,"custom-button",11),h("click",function(){return i.create()}),s()()()()),t&2&&(n(3),l("model",i.model)("validations",i.validations==null?null:i.validations.get("id"))("errorMessage",i.errorMessage)("enabled",!i.isEditMode()),n(2),l("model",i.model)("validations",i.validations==null?null:i.validations.get("name")),n(3),l("model",i.model)("validations",i.validations==null?null:i.validations.get("description")),n(2),l("model",i.model)("validations",i.validations==null?null:i.validations.get("logo")),n(3),l("model",i.model)("validations",i.validations==null?null:i.validations.get("date_release")),n(2),l("model",i.model)("enabled",!0)("validations",i.validations==null?null:i.validations.get("date_revision")),n(3),l("primary",!1),n(),l("enabled",i.formValid&&!i.errorMessage))},dependencies:[F,_,C,I],styles:[".buttons-layout[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}"]});let r=a;return r})(),f=function(r){return r[r.CREATE=0]="CREATE",r[r.EDIT=1]="EDIT",r}(f||{});export{W as ProductEditComponent};
